YUI.add("moodle-mod_bigbluebuttonbn-modform",function(n,t){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.modform={datasource:null,bigbluebuttonbn:{},strings:{},init:function(t){this.datasource=new n.DataSource.Get({source:M.cfg.wwwroot+"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey="+M.cfg.sesskey+"&"}),this.bigbluebuttonbn=t,this.strings={as:M.util.get_string("mod_form_field_participant_list_text_as","bigbluebuttonbn"),viewer:M.util.get_string("mod_form_field_participant_bbb_role_viewer","bigbluebuttonbn"),moderator:M.util.get_string("mod_form_field_participant_bbb_role_moderator","bigbluebuttonbn"),remove:M.util.get_string("mod_form_field_participant_list_action_remove","bigbluebuttonbn")},this.updateInstanceTypeProfile(),this.participantListInit(),this.serverParticipantCount()},updateInstanceTypeProfile:function(){var t=n.one("#id_type"),e=this.bigbluebuttonbn.instanceTypeDefault;null!==t&&(e=t.get("value")),this.applyInstanceTypeProfile(e)},applyInstanceTypeProfile:function(t){var e=this.isFeatureEnabled(t,"all");this.showFieldset("id_room",e||this.isFeatureEnabled(t,"showroom")),this.showInput("id_record",e||this.isFeatureEnabled(t,"showroom")),this.showFieldset("id_recordings",e||this.isFeatureEnabled(t,"showrecordings")),this.showInput("id_recordings_imported",e||this.isFeatureEnabled(t,"showrecordings")),this.showFieldset("id_preuploadpresentation",e||this.isFeatureEnabled(t,"preuploadpresentation")),this.showFieldset("id_permissions",e||this.isFeatureEnabled(t,"permissions")),this.showFieldset("id_schedule",e||this.isFeatureEnabled(t,"schedule")),this.showFieldset("id_modstandardelshdr",e||this.isFeatureEnabled(t,"modstandardelshdr")),this.showFieldset("id_availabilityconditionsheader",e||this.isFeatureEnabled(t,"availabilityconditionsheader")),this.showFieldset("id_tagshdr",e||this.isFeatureEnabled(t,"tagshdr")),this.showFieldset("id_competenciessection",e||this.isFeatureEnabled(t,"competenciessection")),this.showFormGroup("completionattendancegroup",e||this.isFeatureEnabled(t,"completionattendance")),this.showFormGroup("completionengagementgroup",e||this.isFeatureEnabled(t,"completionengagement"))},isFeatureEnabled:function(t,e){return-1!=this.bigbluebuttonbn.instanceTypeProfiles[t].features.indexOf(e)},showFieldset:function(t,e){t=n.one("#"+t);t&&(e?t.setStyle("display","block"):t.setStyle("display","none"))},showInput:function(t,e){var t=n.one("#"+t);t&&(t=t.ancestor("div").ancestor("div"),e?t.setStyle("display","block"):t.setStyle("display","none"))},showFormGroup:function(t,e){t=n.one("#fgroup_id_"+t);t&&(e?t.removeClass("hidden"):t.addClass("hidden"))},participantSelectionSet:function(){var t,e,i,n;for(this.selectClear("bigbluebuttonbn_participant_selection"),t=document.getElementById("bigbluebuttonbn_participant_selection_type"),e=0;e<t.options.length;e++)if(t.options[e].selected){for(n in i=this.bigbluebuttonbn.participantData[t.options[e].value].children)i.hasOwnProperty(n)&&this.selectAddOption("bigbluebuttonbn_participant_selection",i[n].name,i[n].id);"all"===t.options[e].value?(this.selectAddOption("bigbluebuttonbn_participant_selection","---------------","all"),this.selectDisable("bigbluebuttonbn_participant_selection")):this.selectEnable("bigbluebuttonbn_participant_selection")}},participantListInit:function(){var t,e,i,n,s;for(this.participantListClear(),s=0;s<this.bigbluebuttonbn.participantList.length;s++)t=this.bigbluebuttonbn.participantList[s].selectiontype,e=this.bigbluebuttonbn.participantList[s].selectionid,i=this.bigbluebuttonbn.participantList[s].role,n=this.bigbluebuttonbn.participantData[t],"all"==t||"undefined"!=typeof n.children[e]?this.participantAddToForm(t,e,i,0<s):this.participantRemoveFromMemory(t,e);this.participantListUpdate()},participantListClear:function(){for(var t=document.getElementById("participant_list_table"),e=t.getElementsByTagName("tr"),i=e.length;0<i;i--)t.deleteRow(0)},participantListUpdate:function(){document.getElementsByName("participants")[0].value=JSON.stringify(this.bigbluebuttonbn.participantList).replace(/"/g,"&quot;")},participantRemove:function(t,e){this.participantRemoveFromMemory(t,e),this.participantRemoveFromForm(t,e),this.participantListUpdate()},participantRemoveFromMemory:function(t,e){for(var i=""===e?null:e,n=0;n<this.bigbluebuttonbn.participantList.length;n++)this.bigbluebuttonbn.participantList[n].selectiontype==t&&this.bigbluebuttonbn.participantList[n].selectionid==i&&this.bigbluebuttonbn.participantList.splice(n,1)},participantRemoveFromForm:function(t,e){for(var i="participant_list_tr_"+t+"-"+e,n=document.getElementById("participant_list_table"),s=0;s<n.rows.length;s++)n.rows[s].id==i&&n.deleteRow(s)},participantAdd:function(){for(var t=document.getElementById("bigbluebuttonbn_participant_selection_type"),e=document.getElementById("bigbluebuttonbn_participant_selection"),i=0;i<this.bigbluebuttonbn.participantList.length;i++)if(this.bigbluebuttonbn.participantList[i].selectiontype==t.value&&this.bigbluebuttonbn.participantList[i].selectionid==e.value)return;this.participantAddToMemory(t.value,e.value),this.participantAddToForm(t.value,e.value,"viewer",!0),this.participantListUpdate()},participantAddToMemory:function(t,e){this.bigbluebuttonbn.participantList.push({selectiontype:t,selectionid:e,role:"viewer"})},participantAddToForm:function(t,e,i,n){var s,o,a,l,r,b=document.getElementById("participant_list_table"),u=b.insertRow(b.rows.length);for(u.id="participant_list_tr_"+t+"-"+e,(r=u.insertCell(0)).width="125px",r.innerHTML="<b><i>"+this.bigbluebuttonbn.participantData[t].name,r.innerHTML+=("all"!==t?":&nbsp;":"")+"</i></b>",(b=u.insertCell(1)).innerHTML="","all"!==t&&(b.innerHTML=this.bigbluebuttonbn.participantData[t].children[e].name),s="&nbsp;<i>"+this.strings.as+"</i>&nbsp;",s+='<select id="participant_list_role_'+t+"-"+e+'"',s+=" onchange=\"M.mod_bigbluebuttonbn.modform.participantListRoleUpdate('",s+=t+"', '"+e,s+='\'); return 0;" class="select custom-select">',a=["viewer",
"moderator"],l=0;l<a.length;l++)o="",s+='<option value="'+a[l]+'"'+(o=a[l]===i?' selected="selected"':o)+">"+this.strings[a[l]]+"</option>";s+="</select>",u.insertCell(2).innerHTML=s,(r=u.insertCell(3)).width="20px",b=this.strings.remove,u="btn btn-secondary btn-sm",this.bigbluebuttonbn.iconsEnabled&&(b=this.bigbluebuttonbn.pixIconDelete,u="btn btn-link"),s="",n&&(s='<a class="'+u+'" onclick="M.mod_bigbluebuttonbn.modform.participantRemove(\'',s+=t+"', '"+e,s+='\'); return 0;" title="'+this.strings.remove+'">'+b+"</a>"),r.innerHTML=s},participantListRoleUpdate:function(t,e){for(var i=document.getElementById("participant_list_role_"+t+"-"+e),n=0;n<this.bigbluebuttonbn.participantList.length;n++)this.bigbluebuttonbn.participantList[n].selectiontype==t&&this.bigbluebuttonbn.participantList[n].selectionid==(""===e?null:e)&&(this.bigbluebuttonbn.participantList[n].role=i.value);this.participantListUpdate()},selectClear:function(t){for(var e=document.getElementById(t);0<e.length;)e.remove(e.length-1)},selectEnable:function(t){document.getElementById(t).disabled=!1},selectDisable:function(t){document.getElementById(t).disabled=!0},selectAddOption:function(t,e,i){var n=document.getElementById(t),t=document.createElement("option");t.text=e,t.value=i,n.add(t,t.length)},serverParticipantCount:function(){var t=n.one("#chkShowTotalUsers");n.DOM.setAttribute(t,"onchange","M.mod_bigbluebuttonbn.modform.showConnectedUsers(this);")},showConnectedUsers:function(e){var i=n.one("#totalUsers");1==e.checked?(n.DOM.setAttribute(e,"disabled",!0),this.datasource.sendRequest({request:"action=meeting_info&id="+this.bigbluebuttonbn.meetingid+"&bigbluebuttonbn="+this.bigbluebuttonbn.bigbluebuttonbnid,callback:{success:function(t){e.removeAttribute("disabled");t=t.data.info.participantCount;!t&&0!==t||i.set("value",t)}}})):i.set("value","?")}}},"@VERSION@",{requires:["base","node","datasource-get"]});