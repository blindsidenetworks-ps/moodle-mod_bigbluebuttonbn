YUI.add("moodle-mod_bigbluebuttonbn-recordings",function(s,t){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.recordings={datasource:null,datatable:{},locale:"en",windowVideoPlay:null,table:null,bbbid:0,init:function(t){var i,e,n=t&&t.hide_table&&!0===t.hide_table;this.bbbid=t.bbbid,this.datasource=new s.DataSource.Get({source:M.cfg.wwwroot+"/mod/bigbluebuttonbn/bbb_ajax.php?sesskey="+M.cfg.sesskey+"&"}),(i=this).datasource.sendRequest({request:"id="+this.bbbid+"&action=recording_list_table",callback:{success:function(t){var e=t.data;n||!1!==e.recordings_html||-1==e.profile_features.indexOf("all")&&-1==e.profile_features.indexOf("showrecordings")||(i.locale=e.locale,i.datatable.columns=e.data.columns,i.datatable.data=i.datatableInitFormatDates(e.data.data),i.datatableInit())}}}),(e=s.one("#bigbluebuttonbn_recordings_searchform"))&&e.delegate("click",function(t){t.preventDefault(),t.stopPropagation();var e=null;"searchsubmit"==t.target.get("id")?e=s.one("#searchtext").get("value"):s.one("#searchtext").set("value",""),this.filterByText(e)},"input[type=submit]",this),M.mod_bigbluebuttonbn.helpers.init()},datatableInitFormatDates:function(t){var e,i;for(e=0;e<t.length;e++)i=new Date(t[e].date),t[e].date=i.toLocaleDateString(this.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"});return t},initExtraLanguage:function(t){t.Intl.add("datatable-paginator",t.config.lang,{first:M.util.get_string("view_recording_yui_first","bigbluebuttonbn"),prev:M.util.get_string("view_recording_yui_prev","bigbluebuttonbn"),next:M.util.get_string("view_recording_yui_next","bigbluebuttonbn"),last:M.util.get_string("view_recording_yui_last","bigbluebuttonbn"),goToLabel:M.util.get_string("view_recording_yui_page","bigbluebuttonbn"),goToAction:M.util.get_string("view_recording_yui_go","bigbluebuttonbn"),perPage:M.util.get_string("view_recording_yui_rows","bigbluebuttonbn"),showAll:M.util.get_string("view_recording_yui_show_all","bigbluebuttonbn")})},escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filterByText:function(t){var e,n,i;this.table&&(this.table.set("data",this.datatable.data),t&&(e=this.table.data,n=new RegExp("<span>.*?"+this.escapeRegex(t)+".*?</span>","i"),i=e.filter({asList:!0},function(t){var e=t.get("recording"),i=t.get("description");return e&&n.test(e)||i&&n.test(i)}),this.table.set("data",i)))},datatableInit:function(){var i=this.datatable.columns,n=this.datatable.data,o=this.initExtraLanguage;YUI({lang:this.locale}).use("intl","datatable","datatable-sort","datatable-paginator","datatype-number",function(t){o(t);var e=new t.DataTable({width:"1195px",columns:i,data:n,rowsPerPage:10,paginatorLocation:["header","footer"]}).render("#bigbluebuttonbn_recordings_table");return M.mod_bigbluebuttonbn.recordings.table=e})},recordingElementPayload:function(t){var e=s.one(t),i=e.ancestor("div");return{action:e.getAttribute("data-action"),recordingid:i.getAttribute("data-recordingid"),meetingid:i.getAttribute("data-meetingid")}},recordingAction:function(t,e,i){var n,o=this.recordingElementPayload(t);for(n in i)o[n]=i[n];e?new M.core.confirm({modal:!0,centered:!0,question:this.recordingConfirmationMessage(o)}).on("complete-yes",function(){this.recordingActionPerform(o)},this):this.recordingActionPerform(o)},recordingActionPerform:function(t){M.mod_bigbluebuttonbn.helpers.toggleSpinningWheelOn(t),M.mod_bigbluebuttonbn.broker.recordingActionPerform(t);var i=this;this.datasource.sendRequest({request:"&id="+this.bbbid+"&action=recording_list_table",callback:{success:function(t){var e=t.data;!1!==e.recordings_html||-1==e.profile_features.indexOf("all")&&-1==e.profile_features.indexOf("showrecordings")||(i.locale=e.locale,i.datatable.columns=e.data.columns,i.datatable.data=i.datatableInitFormatDates(e.data.data))}}})},recordingPublish:function(t){this.recordingAction(t,!1,{source:"published",goalstate:"true"})},recordingUnpublish:function(t){this.recordingAction(t,!1,{source:"published",goalstate:"false"})},recordingProtect:function(t){this.recordingAction(t,!1,{source:"protected",goalstate:"true"})},recordingUnprotect:function(t){this.recordingAction(t,!1,{source:"protected",goalstate:"false"})},recordingDelete:function(t){var e={source:"found",goalstate:!1},i=!0;this.recordingIsImported(t)&&(i=!1,e.source="status",e.goalstate=!0,e.attempts=1),this.recordingAction(t,i,e)},recordingImport:function(t){this.recordingAction(t,!0,{})},recordingUpdate:function(t){var e=s.one(t),i=e.ancestor("div"),n={target:i.getAttribute("data-target"),source:i.getAttribute("data-source"),goalstate:e.getAttribute("data-goalstate")};this.recordingAction(t,!1,n)},recordingEdit:function(t){var e,i=s.one(t),n=i.ancestor("div"),o=n.one("> span");o.hide(),i.hide(),(e=s.Node.create('<input type="text" class="form-control"></input>')).setAttribute("id",i.getAttribute("id")),e.setAttribute("value",o.getHTML()),e.setAttribute("data-value",o.getHTML()),e.on("keydown",M.mod_bigbluebuttonbn.recordings.recordingEditKeydown),e.on("focusout",M.mod_bigbluebuttonbn.recordings.recordingEditOnfocusout),n.append(e),e.focus().select()},recordingEditKeydown:function(t){var e=t.which||t.keyCode;13!=e?27==e&&M.mod_bigbluebuttonbn.recordings.recordingEditOnfocusout(t.currentTarget):M.mod_bigbluebuttonbn.recordings.recordingEditPerform(t.currentTarget)},recordingEditOnfocusout:function(t){var e=t.ancestor("div");t.hide(),e.one("> span").show(),e.one("> a").show()},recordingEditPerform:function(t){var e=t.ancestor("div"),i=t.get("value").trim();t.setAttribute("data-action","edit"),t.setAttribute("data-goalstate",i),t.hide(),this.recordingUpdate(t.getDOMNode()),e.one("> span").setHTML(i).show(),e.one("> a").show()},recordingEditCompletion:function(t,e){var i,n=M.mod_bigbluebuttonbn.helpers.elementId(t.action,t.target),o=s.one("a#"+n+"-"+t.recordingid),r=o.ancestor("div"),a=r.one("> span");void 0!==a&&(i=r.one("> input"),e&&a.setHTML(i.getAttribute("data-value")),i.remove())},recordingPlay:function(t
){var e,i=s.one(t);""!==i.getAttribute("data-href")?(e={target:i.getAttribute("data-target"),source:"published",goalstate:"true",attempts:1,dataset:i.getData()},this.windowVideoPlay=window.open("","_blank"),this.windowVideoPlay.opener=null,this.recordingAction(t,!1,e)):M.mod_bigbluebuttonbn.helpers.alertError(M.util.get_string("view_recording_format_errror_unreachable","bigbluebuttonbn"))},recordingConfirmationMessage:function(t){var e,i,n,o,r;return void 0===(e=M.util.get_string("view_recording_"+t.action+"_confirmation","bigbluebuttonbn"))?"":(i=M.util.get_string("view_recording","bigbluebuttonbn"),"true"===s.one("#playbacks-"+t.recordingid).get("dataset").imported&&(i=M.util.get_string("view_recording_link","bigbluebuttonbn")),e=e.replace("{$a}",i),"import"===t.action?e:(n=M.mod_bigbluebuttonbn.helpers.elementId(t.action,t.target),0===(o=s.one("a#"+n+"-"+t.recordingid).get("dataset").links)?e:(r=M.util.get_string("view_recording_"+t.action+"_confirmation_warning_p","bigbluebuttonbn"),1==o&&(r=M.util.get_string("view_recording_"+t.action+"_confirmation_warning_s","bigbluebuttonbn")),(r=r.replace("{$a}",o)+". ")+"\n\n"+e)))},recordingActionCompletion:function(t){var e,i;if("delete"==t.action)return 1==(i=s.one("div#recording-actionbar-"+t.recordingid).ancestor("td").ancestor("tr")).ancestor("tbody").all("tr").size()?((e=s.one("#bigbluebuttonbn_view_recordings_content")).prepend("<span>"+M.util.get_string("view_message_norecordings","bigbluebuttonbn")+"</span>"),void e.one("#bigbluebuttonbn_recordings_table").remove()):void i.remove();if("import"!=t.action){if("play"==t.action)return M.mod_bigbluebuttonbn.helpers.toggleSpinningWheelOff(t),void(this.windowVideoPlay.location.href=t.dataset.href);M.mod_bigbluebuttonbn.helpers.updateData(t),M.mod_bigbluebuttonbn.helpers.toggleSpinningWheelOff(t),M.mod_bigbluebuttonbn.helpers.updateId(t),"publish"!==t.action?"unpublish"!==t.action||this.recordingUnpublishCompletion(t.recordingid):this.recordingPublishCompletion(t.recordingid)}else(i=s.one("div#recording-actionbar-"+t.recordingid).ancestor("td").ancestor("tr")).remove()},recordingActionFailover:function(t){M.mod_bigbluebuttonbn.helpers.alertError(t.message),M.mod_bigbluebuttonbn.helpers.toggleSpinningWheelOff(t),"edit"===t.action&&this.recordingEditCompletion(t,!0)},recordingPublishCompletion:function(t){var e,i=s.one("#playbacks-"+t);i.show(),null!==(e=s.one("#preview-"+t))&&(e.show(),M.mod_bigbluebuttonbn.helpers.reloadPreview(t))},recordingUnpublishCompletion:function(t){var e,i=s.one("#playbacks-"+t);i.hide(),null!==(e=s.one("#preview-"+t))&&e.hide()},recordingIsImported:function(t){var e=s.one(t),i=e.ancestor("tr");return"true"===i.getAttribute("data-imported")}},M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.helpers={elementTag:{},elementFaClass:{},elementActionReversed:{},init:function(){this.elementTag=this.initElementTag(),this.elementFaClass=this.initElementFAClass(),this.elementActionReversed=this.initElementActionReversed()},toggleSpinningWheelOn:function(t){var e,i,n,o;e=this.elementId(t.action,t.target),o=M.util.get_string("view_recording_list_action_"+t.action,"bigbluebuttonbn"),(i=s.one("a#"+e+"-"+t.recordingid)).setAttribute("data-onclick",i.getAttribute("onclick")),i.setAttribute("onclick",""),null!==(n=i.one("> i"))?(n.setAttribute("data-aria-label",n.getAttribute("aria-label")),n.setAttribute("aria-label",o),n.setAttribute("data-title",n.getAttribute("title")),n.setAttribute("title",o),n.setAttribute("data-class",n.getAttribute("class")),n.setAttribute("class",this.elementFaClass.process)):this.toggleSpinningWheelOnCompatible(i,o)},toggleSpinningWheelOnCompatible:function(t,e){var i=t.one("> img");null!==i&&(i.setAttribute("data-alt",i.getAttribute("alt")),i.setAttribute("alt",e),i.setAttribute("data-title",i.getAttribute("title")),i.setAttribute("title",e),i.setAttribute("data-src",i.getAttribute("src")),i.setAttribute("src","pix/i/processing16.gif"))},toggleSpinningWheelOff:function(t){var e,i,n;e=this.elementId(t.action,t.target),(i=s.one("a#"+e+"-"+t.recordingid)).setAttribute("onclick",i.getAttribute("data-onclick")),i.removeAttribute("data-onclick"),null!==(n=i.one("> i"))?(n.setAttribute("aria-label",n.getAttribute("data-aria-label")),n.removeAttribute("data-aria-label"),n.setAttribute("title",n.getAttribute("data-title")),n.removeAttribute("data-title"),n.setAttribute("class",n.getAttribute("data-class")),n.removeAttribute("data-class")):this.toggleSpinningWheelOffCompatible(i.one("> img"))},toggleSpinningWheelOffCompatible:function(t){null!==t&&(t.setAttribute("alt",t.getAttribute("data-alt")),t.removeAttribute("data-alt"),t.setAttribute("title",t.getAttribute("data-title")),t.removeAttribute("data-title"),t.setAttribute("src",t.getAttribute("data-src")),t.removeAttribute("data-src"))},updateData:function(t){var e,i,n,o,r,a,l;(e=this.elementActionReversed[t.action])!==t.action&&(i=this.elementId(t.action,t.target),(n=s.one("a#"+i+"-"+t.recordingid)).setAttribute("data-action",e),o=n.getAttribute("data-onclick").replace(this.capitalize(t.action),this.capitalize(e)),n.setAttribute("data-onclick",o),a=M.util.get_string("view_recording_list_actionbar_"+e,"bigbluebuttonbn"),l=this.elementTag[e],null!==(r=n.one("> i"))?(r.setAttribute("data-aria-label",a),r.setAttribute("data-title",a),r.setAttribute("data-class",this.elementFaClass[e])):this.updateDataCompatible(n.one("> img"),this.elementTag[t.action],l,a))},updateDataCompatible:function(t,e,i,n){if(null!==t){var o=t.getAttribute("data-src");t.setAttribute("data-alt",n),t.setAttribute("data-title",n),t.setAttribute("data-src",o.replace(i,e))}},updateId:function(t){var e,i,n,o,r;(e=this.elementActionReversed[t.action])!==t.action&&(i=this.elementId(t.action,t.target),n=s.one("a#"+i+"-"+t.recordingid),r=i.replace(t.action,e)+"-"+t.recordingid,n.setAttribute("id",r),null===(o=n.one("> i"))&&(o=n.one("> img")),o.removeAttribute("id"))},elementId:function(t,e){var i="recording-"+t;return void 0!==e&&(
i+="-"+e),i},initElementTag:function(){var t={play:"play",publish:"hide",unpublish:"show",protect:"lock",unprotect:"unlock",edit:"edit",process:"process","import":"import","delete":"delete"};return t},initElementFAClass:function(){var t={publish:"icon fa fa-eye-slash fa-fw iconsmall",unpublish:"icon fa fa-eye fa-fw iconsmall",protect:"icon fa fa-unlock fa-fw iconsmall",unprotect:"icon fa fa-lock fa-fw iconsmall",edit:"icon fa fa-pencil fa-fw iconsmall",process:"icon fa fa-spinner fa-spin iconsmall","import":"icon fa fa-download fa-fw iconsmall","delete":"icon fa fa-trash fa-fw iconsmall"};return t},initElementActionReversed:function(){var t={play:"play",publish:"unpublish",unpublish:"publish",protect:"unprotect",unprotect:"protect",edit:"edit","import":"import","delete":"delete"};return t},reloadPreview:function(t){s.one("#preview-"+t).all("> img").each(function(t){var e=t.getAttribute("src");e=e.substring(0,e.indexOf("?")),e+="?"+(new Date).getTime(),t.setAttribute("src",e)})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},alertError:function(t,e){void 0===e&&(e="error"),new M.core.alert({title:M.util.get_string(e,"moodle"),message:t}).show()}}},"@VERSION@",{requires:["base","node","datasource-get","datasource-jsonschema","datasource-polling","moodle-core-notification"]});