YUI.add("moodle-mod_bigbluebuttonbn-custom",function(n,e){M.mod_bigbluebuttonbn=M.mod_bigbluebuttonbn||{},M.mod_bigbluebuttonbn.custom={bigbluebuttonbn:{},lastIndex:0,init:function(e){this.bigbluebuttonbn=e;let t=n.one("#admin-bigbluebuttonbn_enable_cluster");e=document.getElementById("id_s__bigbluebuttonbn_enable_cluster");n.DOM.setAttribute(e,"onchange","M.mod_bigbluebuttonbn.custom.showCluster(this);"),t.insert(this.table,"after"),this.showCluster(e);e=document.getElementById("add_server");n.DOM.setAttribute(e,"onclick","M.mod_bigbluebuttonbn.custom.add()");var l,d=JSON.parse(this.bigbluebuttonbn.cluster);d&&(console.log(d),l=this,Object.keys(d).forEach(function(e,t){var n=d[e].server_url,r=d[e].shared_secret;l.addServer(t,e,n,r)})),this.addServer()},table:`<div class="container mb-5" id="cluster_table">
                            <div class="row clearfix">
                                <div class="col-md-12 table-responsive">
                                    <table id = "clusterTable" class="table table-bordered table-hover table-sortable">
                                        <thead>
                                            <tr >
                                                <th class="text-center">Server Name</th>
                                                <th class="text-center">Server Url</th>
                                                <th class="text-center">Shared Secret</th>
                                                <th class="text-center" style="border-top: 1px solid #ffffff; border-right: 1px solid #ffffff;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="cluster-tbody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <a id="add_server" class="btn btn-primary text-white float-right" style="cursor: pointer;">Add Server</a>
                        </div>`,showCluster:function(e){e.checked?this.enableCluster():this.disableCluster()},enableCluster:function(){n.one("#admin-bigbluebuttonbn_server_url").hide(),n.one("#admin-bigbluebuttonbn_shared_secret").hide(),n.one("#cluster_table").show()},disableCluster:function(){n.one("#admin-bigbluebuttonbn_server_url").show(),n.one("#admin-bigbluebuttonbn_shared_secret").show(),n.one("#cluster_table").hide()},addServer:function(e=this.lastIndex,t="",n="",r=""){let l=document.getElementById("cluster-tbody"),d,b,s,a=document.createElement("tr");var o=["Server Name","Server Ulr","Shared Secret"],i=["bigbluebuttonbn_cluster["+e+"][server_name]","bigbluebuttonbn_cluster["+e+"][server_url]","bigbluebuttonbn_cluster["+e+"][shared_secret]"];for(let e=0;e<i.length;e++)if(d=document.createElement("td"),b=document.createElement("input"),b.setAttribute("type","text"),b.setAttribute("value",0===e?t:1===e?n:2===e?r:""),b.setAttribute("placeholder",o[e]),b.setAttribute("name",i[e]),b.setAttribute("class","form-control"),0===e&&b.setAttribute("onkeypress","return M.mod_bigbluebuttonbn.custom.validationAN(event);"),d.appendChild(b),d.appendChild(b),a.appendChild(d),2===e){d=document.createElement("td"),s=document.createElement("span"),s.textContent="Ã—";let e=document.createElement("button");e.setAttribute("class","btn btn-danger row-remove"),e.setAttribute("value","delete"),e.setAttribute("onclick","M.mod_bigbluebuttonbn.custom.deleteRow(this)"),e.setAttribute("type","button"),e.appendChild(s),d.appendChild(e),a.appendChild(d),a.appendChild(d)}l.appendChild(a),this.lastIndex=e+1},deleteRow:function(e){let t=e.parentNode.parentNode;t.parentNode.removeChild(t)},validationAN:function(e){var t=new RegExp("^[a-zA-Z0-9]+$"),n=String.fromCharCode(e.charCode||e.which);if(!t.test(n))return e.preventDefault(),!1},add:function(){1==this.validationInput()&&this.addServer()},validationInput:function(){var l=document.getElementById("clusterTable").rows,d=l[0];let b=!0;for(let r=1;r<l.length;r++)for(let n=0;n<l[r].cells.length-1;n++){var s=d.cells[n].innerHTML;let e=l[r].cells[n],t=e.querySelector("input");if(null==t.value||""==t.value){t.focus(),b=!1;break}if("Server Url"==s&&!this.validURL(t.value)){alert("URL is bad"),t.focus(),b=!1;break}}return b},validURL:function(e){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}}},"@VERSION@",{requires:["base","node"]});