{"version":3,"sources":["../src/roomupdater.js"],"names":["updateCount","updateFactor","timerReference","resetValues","stop","clearInterval","poll","setInterval","updateRoom","updatecache","bbbRoomViewElement","document","getElementById","bbbId","dataset","meetingId","then","data","Templates","renderForPromise","html","js","replaceNodeContents","catch","displayException"],"mappings":"4NAeA,uD,GAOIA,CAAAA,CAAW,CAAG,C,CACdC,CAAY,CAAG,C,CACfC,CAAc,CAAG,I,CAEfC,CAAW,CAAG,UAAM,CACtBH,CAAW,CAAG,CAAd,CACAC,CAAY,CAAG,CAClB,C,CAEYG,CAAI,CAAG,UAAM,CACtB,GAAIF,CAAJ,CAAoB,CAChBG,aAAa,CAACH,CAAD,CAAb,CACAA,CAAc,CAAG,IACpB,CAEDC,CAAW,EACd,C,iBAEmB,QAAPG,CAAAA,IAAO,EAAM,CACtBJ,CAAc,CAAGK,WAAW,CAAC,UAAM,CAC/B,GAAqC,CAAjC,EAACP,CAAW,CAAGC,CAAnB,CAAwC,CACpCO,CAAU,IAAV,CAEA,GAAIP,CAAY,EAzBV,EAyBN,CAA+B,CAC3BA,CAAY,CAAG,CAClB,CAFD,IAEO,CACHA,CAAY,EACf,CACJ,CACDD,CAAW,EACd,CAX2B,MAY/B,C,CAEM,GAAMQ,CAAAA,CAAU,CAAG,UAAyB,IAAxBC,CAAAA,CAAwB,2DACzCC,CAAkB,CAAGC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CADoB,CAEzCC,CAAK,CAAGH,CAAkB,CAACI,OAAnB,CAA2BD,KAFM,CAGzCE,CAAS,CAAGL,CAAkB,CAACI,OAAnB,CAA2BC,SAHE,CAK/C,MAAO,qBAAeF,CAAf,CAAsBE,CAAtB,CAAiCN,CAAjC,EACFO,IADE,CACG,SAAAC,CAAI,QAAIC,WAAUC,gBAAV,CAA2B,+BAA3B,CAA4DF,CAA5D,CAAJ,CADP,EAEFD,IAFE,CAEG,eAAEI,CAAAA,CAAF,GAAEA,IAAF,CAAQC,CAAR,GAAQA,EAAR,OAAgBH,WAAUI,mBAAV,CAA8BZ,CAA9B,CAAkDU,CAAlD,CAAwDC,CAAxD,CAAhB,CAFH,EAGFE,KAHE,CAGIC,WAHJ,CAIV,CATM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport Templates from \"core/templates\";\nimport {exception as displayException} from 'core/notification';\nimport {getMeetingInfo} from './repository';\n\nconst timeout = 1000;\nconst maxFactor = 10;\n\nlet updateCount = 0;\nlet updateFactor = 1;\nlet timerReference = null;\n\nconst resetValues = () => {\n    updateCount = 0;\n    updateFactor = 1;\n};\n\nexport const stop = () => {\n    if (timerReference) {\n        clearInterval(timerReference);\n        timerReference = null;\n    }\n\n    resetValues();\n};\n\nexport const poll = () => {\n    timerReference = setInterval(() => {\n        if ((updateCount % updateFactor) === 0) {\n            updateRoom(true);\n\n            if (updateFactor >= maxFactor) {\n                updateFactor = 1;\n            } else {\n                updateFactor++;\n            }\n        }\n        updateCount++;\n    }, timeout);\n};\n\nexport const updateRoom = (updatecache = false) => {\n    const bbbRoomViewElement = document.getElementById('bbb-room-view');\n    const bbbId = bbbRoomViewElement.dataset.bbbId;\n    const meetingId = bbbRoomViewElement.dataset.meetingId;\n\n    return getMeetingInfo(bbbId, meetingId, updatecache)\n        .then(data => Templates.renderForPromise('mod_bigbluebuttonbn/room_view', data))\n        .then(({html, js}) => Templates.replaceNodeContents(bbbRoomViewElement, html, js))\n        .catch(displayException);\n};\n"],"file":"roomupdater.min.js"}