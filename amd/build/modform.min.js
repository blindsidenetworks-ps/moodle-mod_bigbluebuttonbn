define ("mod_bigbluebuttonbn/modform",["exports","core/str","core/notification","core/templates"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function g(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var i=a.apply(b,c);function g(a){f(i,d,e,g,h,"next",a)}function h(a){f(i,d,e,g,h,"throw",a)}g(void 0)})}}var h={instanceTypeSelection:function instanceTypeSelection(){return document.querySelector("select#id_type")},instanceTypeProfiles:function instanceTypeProfiles(){return document.querySelector("[data-profile-types]")},participantData:function participantData(){return document.querySelector("[data-participant-data]")},participantList:function participantList(){return document.getElementsByName("participants")[0]},participantTable:function participantTable(){return document.getElementById("participant_list_table")},participantSelectionType:function participantSelectionType(){return document.getElementsByName("bigbluebuttonbn_participant_selection_type")[0]},participantSelection:function participantSelection(){return document.getElementsByName("bigbluebuttonbn_participant_selection")[0]},participantAddButton:function participantAddButton(){return document.getElementsByName("bigbluebuttonbn_participant_selection_add")[0]}};a.init=function init(a){var b=h.instanceTypeSelection(),c=JSON.parse(h.instanceTypeProfiles().dataset.profileTypes),d=a.instanceTypeDefault;if(null!==b&&-1!==b.selectedIndex){d=b.options[b.selectedIndex].value}var f=function(a,b){var d=c[a].features;return-1!==d.indexOf(b)};i(d,f);b.addEventListener("change",function(a){i(a.target.value,f)});h.participantSelectionType().addEventListener("change",function(a){var b=a.target;q(b)});h.participantAddButton().addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p()});j()};var i=function(a,b){var c=b(a,"all"),d=function(a,b){var c=document.querySelector("#"+a);if(!c){return}if(b){c.style.display="block";return}c.style.display="none"},e=function(a,b){var c=document.querySelector("#"+a);if(!c){return}var d=c.closest("div").closest("div");if(b){d.style.display="block";return}d.style.display="none"},f=function(a,b){var c=document.querySelector("#fgroup_id_"+a);if(!c){return}if(b){c.classList.remove("hidden");return}c.classList.add("hidden")};d("id_room",c||b(a,"showroom"));e("id_record",c||b(a,"showroom"));d("id_recordings",c||b(a,"showrecordings"));e("id_recordings_imported",c||b(a,"showrecordings"));d("id_preuploadpresentation",c||b(a,"preuploadpresentation"));d("id_permissions",c||b(a,"permissions"));d("id_schedule",c||b(a,"schedule"));d("id_modstandardelshdr",c||b(a,"modstandardelshdr"));d("id_availabilityconditionsheader",c||b(a,"availabilityconditionsheader"));d("id_tagshdr",c||b(a,"tagshdr"));d("id_competenciessection",c||b(a,"competenciessection"));f("completionattendancegroup",c||b(a,"completionattendance"));f("completionengagementgroup",c||b(a,"completionengagement"))},j=function(){var a=JSON.parse(h.participantData().dataset.participantData),b=m();b.forEach(function(b){var c=b.selectiontype,d=b.selectionid,e=b.role;if("all"===b.selectiontype||"undefined"!=typeof a[b.selectiontype].children[b.selectionid]){k(c,d,e,!0).then()}})},k=function(){var a=g(regeneratorRuntime.mark(function a(e,f,g,i){var j,k,l,m,p,q,r,s,t,u,v;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:j=JSON.parse(h.participantData().dataset.participantData);a.next=3;return(0,b.get_string)("mod_form_field_participant_bbb_role_viewer","mod_bigbluebuttonbn");case 3:k=a.sent;a.next=6;return(0,b.get_string)("mod_form_field_participant_bbb_role_moderator","mod_bigbluebuttonbn");case 6:l=a.sent;m={viewer:{id:"viewer",label:k},moderator:{id:"moderator",label:l}};m[g].isselected=!0;a.prev=9;p=document.querySelector("#participant_list_table tbody");q={selectiontypevalue:e,selectionvalue:f,participanttype:j[e].name,participantvalue:"all"!==e?j[e].children[f].name:null,roles:Object.values(m),canRemove:i};a.next=14;return d.default.renderForPromise("mod_bigbluebuttonbn/participant_form_add",q);case 14:r=a.sent;s=r.html;t=r.js;u=d.default.appendNodeContents(p,s,t)[0];u.querySelector(".participant-select").addEventListener("change",function(){o(e,f)});v=u.querySelector(".remove-button");if(v){v.addEventListener("click",function(){n(e,f)})}a.next=26;break;case 23:a.prev=23;a.t0=a["catch"](9);c.default.exception(a.t0);case 26:case"end":return a.stop();}}},a,null,[[9,23]])}));return function(){return a.apply(this,arguments)}}(),l=function(a){var b=h.participantList();b.value=JSON.stringify(a)},m=function(){var a=h.participantList().value;if(a){return JSON.parse(a)}return[]},n=function(a,b){for(var c=m(),d="participant_list_tr_"+a+"-"+b,e=h.participantTable(),f=""===b?null:b,g=0;g<c.length;g++){if(c[g].selectiontype===a&&c[g].selectionid===f){c.splice(g,1)}}for(var j=0;j<e.rows.length;j++){if(e.rows[j].id===d){e.deleteRow(j)}}l(c)},o=function(a,b){for(var c=document.querySelector("#participant_list_tr_".concat(a,"-").concat(b," .participant-select")),d=m(),e=0;e<d.length;e++){if(d[e].selectiontype===a&&d[e].selectionid===(""===b?null:parseInt(b))){d[e].role=c.value}}l(d)},p=function(){for(var a=h.participantSelectionType(),b=h.participantSelection(),c=m(),d=0;d<c.length;d++){if(c[d].selectiontype===a.value&&c[d].selectionid===b.value){return}}c.push({selectiontype:a.value,selectionid:b.value,role:"viewer"});k(a.value,b.value,"viewer",!0).then();l(c)},q=function(a){var b=function(a,b,c){var d=document.createElement("option");d.text=b;d.value=c;a.add(d)},c=JSON.parse(h.participantData().dataset.participantData),d=h.participantSelection();while(d.firstChild){d.removeChild(d.firstChild)}if(-1!==a.selectedIndex){var e=Object.values(c[a.value].children);e.forEach(function(a){b(d,a.name,a.id)});if("all"===a.value){b(d,"---------------","all");d.disabled=!0}else{d.disabled=!1}}}});
//# sourceMappingURL=modform.min.js.map
